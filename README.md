# 图片颜色简化工具

将图片转换为 BMP 格式，并将图片简化为指定数量的主要颜色。

## 功能特点

- 读取多种格式图片（JPG、PNG、GIF、BMP 等）
- 使用 K-means 聚类算法提取图片中的主要颜色（2-10 种）
- 将所有像素映射到最接近的主要颜色（统一相近的颜色）
- 输出为 BMP 格式
- 提供命令行工具和网页版界面

## 安装依赖

```bash
pip install -r requirements.txt
```

或者手动安装：

```bash
pip install Pillow numpy scikit-learn Flask
```

## 使用方法

本工具提供两种使用方式：**命令行版本**和**网页版本**。

### 方式一：网页版（推荐）

网页版提供直观的图形界面，支持拖放上传、实时预览和颜色数量调节。

#### 启动服务器

```bash
python3 app.py
```

#### 访问网页

在浏览器中打开：`http://localhost:5000`

#### 功能说明

1. **上传图片**：点击或拖放图片到上传区域
2. **选择颜色数量**：使用滑块选择要保留的颜色数量（2-10 种）
3. **预览颜色**：点击"预览颜色"按钮查看将要提取的主要颜色
4. **转换下载**：点击"转换并下载"按钮生成并下载 BMP 文件

### 方式二：命令行版本

适合批处理或脚本自动化。

#### 基本用法（3 种颜色）

```bash
python3 image_converter.py input.jpg
```

这会生成一个名为 `input_3colors.bmp` 的文件。

#### 指定输出文件名

```bash
python3 image_converter.py input.jpg output.bmp
```

## 示例

假设你有一张名为 `photo.jpg` 的照片：

```bash
python image_converter.py photo.jpg
```

程序会：
1. 分析图片中的所有像素
2. 使用聚类算法找出 3 种最具代表性的颜色
3. 将每个像素替换为最接近的主要颜色
4. 保存为 `photo_3colors.bmp`

## 工作原理

1. **读取图片**：使用 Pillow 库读取 JPG 文件
2. **颜色提取**：使用 K-means 聚类算法分析所有像素，找出 3 个聚类中心作为主要颜色
3. **颜色映射**：计算每个像素与 3 种主要颜色的欧几里得距离，将像素替换为最近的颜色
4. **格式转换**：保存为 BMP 格式

## 技术细节

- 使用 K-means 聚类确保提取的是真正的"主要"颜色（出现频率最高的颜色区域）
- 通过欧几里得距离计算颜色相似度
- 支持 RGB 和 RGBA 格式的输入图片

## 项目结构

```
hoi/
├── app.py                    # Flask 网页应用
├── image_converter.py        # 命令行工具
├── requirements.txt          # Python 依赖
├── README.md                # 说明文档
├── templates/               # HTML 模板
│   └── index.html          # 主页面
└── static/                  # 静态资源
    ├── css/
    │   └── style.css       # 样式文件
    └── js/
        └── script.js       # JavaScript 脚本
```

## 注意事项

- 输入文件必须是有效的图片文件（支持 JPG、PNG、GIF、BMP 等格式）
- 处理大图片可能需要较长时间
- 输出的 BMP 文件大小可能比原 JPG 文件大
- 网页版最大支持 16MB 的图片文件
- 首次运行需要先安装所有依赖

## 常见问题

**Q: 为什么转换后的文件这么大？**
A: BMP 格式是未压缩的位图格式，文件大小通常比 JPG 大。如果需要更小的文件，可以在转换后使用其他工具压缩。

**Q: 可以转换其他格式吗？**
A: 输入支持所有 Pillow 支持的格式（JPG、PNG、GIF 等），输出目前仅支持 BMP。可以修改代码轻松支持其他输出格式。

**Q: 颜色数量越多越好吗？**
A: 不一定。颜色数量越少，简化效果越明显。建议从 3 种颜色开始尝试，根据效果调整。
